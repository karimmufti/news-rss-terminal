<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RSS Terminal (NYT)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
  --bg: #050506;        /* darker background */
  --panel: #0b0c0e;     /* panel background */
  --border: #1a1b1e;    /* subtle dividers */
  --fg: #ffffff;        /* white text */
  --muted: #8b8f97;     /* muted gray text */
 --ok: #a1fb33;
}



    html,body{
      margin:0; padding:0; height:100%;
      background:var(--bg); color:var(--fg);
      font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    }
    .wrap{max-width:980px;margin:0 auto;padding:16px 12px 48px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .title{font-weight:700;letter-spacing:.5px; font-size: 39px;}
    .badge{color:var(--bg);background:var(--ok);padding:2px 8px;border-radius:999px;font-size:12px}
    .muted{color:var(--muted)}
    .panel{
      background:var(--panel); border:1px solid var(--border); border-radius:10px;
      padding:8px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
    }
  .date{
    color: var(--muted)
  }
    /* 3 columns: TIME | WEBSITE | HEADLINE (headline all the way right) */
    .row {
  display: grid;
  grid-template-columns: 1fr 110px 115px auto ; /* headline expands, website right */
  gap: 10px;
  padding: 0 8px;
  border-bottom: 1px solid var(--border);
  align-items: center;
  min-height: 42px; height: 42px;
  
}

    .row:last-child{border-bottom:0}
  
    /* header row labels */
    .row.head{
      color:var(--muted); text-transform:uppercase; font-size:12px; letter-spacing:.06em;
      border-bottom:1px solid var(--border);
      height:34px; min-height:34px;
    }
    .striped .row:not(.head):nth-child(even) {
  background-color: rgb(22, 28, 17); /* subtle light overlay */
}
  
    .time{color:var(--muted);}
    .source{color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
  
    /* headline cell: single line with ellipsis */
    .titlecell{overflow:hidden}
    .titlelink{
      color:#fff; text-decoration:none; display:block;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .titlelink:hover{color:#fff; text-decoration:underline}
  
    .controls{display:flex;align-items:center;gap:10px}
    button {
  background: #1a1b21;
  color: #fff;
  border: 1px solid #2a2c33;
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
}
    button:disabled{opacity:.6;cursor:default}
    button.active {
  background: var(--ok);   /* green */
  color: var(--bg);        /* dark text on green */
  border-color: var(--ok);
}
    .error{color:#ff6b6b;margin-top:8px}
    .footer{margin-top:10px;color:var(--muted);font-size:12px}
  </style>
  
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">NYT Live Feed <span id="count" class="badge">0</span></div>
      <div class = "controls">
          <button id="refreshBtn">Refresh</button>
          <button id="autoBtn" class="active">Auto Refresh: on</button>
  <button id="stripeBtn">Striped: off</button>
      </div>
    </header>

    <div id="board" class="panel" role="list" aria-live="polite"></div>
    <div id="error" class="error" hidden></div>
    <div class="footer">Newest first • updates every 30s • links open in a new tab</div>
  </div>

  <script>
    // ===== elements =====
    const board = document.getElementById('board');
    const countBadge = document.getElementById('count');
    const errorEl = document.getElementById('error');
    const refreshBtn = document.getElementById('refreshBtn');
    const autoBtn = document.getElementById('autoBtn');
    const stripeBtn = document.getElementById('stripeBtn');
  
    // ===== state =====
    const AUTO_MS = 30_000;
    let autoTimer = null;
    let autoOn = true;
    let striped = false;
  
    // ===== utils =====
    function timeAgo(iso) {
      const then = new Date(iso).getTime();
      const now = Date.now();
      const mins = Math.max(0, Math.floor((now - then) / 60000));
      if (mins < 1) return 'now';
      if (mins < 60) return mins + 'm ago';
      const hrs = Math.floor(mins / 60);
      const rem = mins % 60;
      return hrs + 'h ' + (rem ? rem + 'm ' : '') + 'ago';
    }
  
    function hostFrom(url) {
      try { return new URL(url).host.replace(/^www\./, ''); }
      catch { return ''; }
    }
  
    // ===== rendering =====
    function renderHeader() {
      const h = document.createElement('div');
      h.className = 'row head';
      const c = document.createElement('div'); c.textContent = 'Headline';
      const d = document.createElement('div'); d.textContent = 'Date';
      const t = document.createElement('div'); t.textContent = 'Time';
      const s = document.createElement('div'); s.textContent = 'Website';
      h.appendChild(c); h.appendChild(d); h.appendChild(t); h.appendChild(s);
      board.appendChild(h);
    }
  
    function rowTemplate(item) {
      const r = document.createElement('div');
      r.className = 'row';
      r.setAttribute('role','listitem');
  
      // headline (left, ellipsis)
      const c = document.createElement('div');
      c.className = 'titlecell';
      const a = document.createElement('a');
      a.className = 'titlelink';
      a.href = item.link; a.target = '_blank'; a.rel = 'noopener noreferrer';
      a.textContent = item.title;
      c.appendChild(a);
  
      // date (YYYY-MM-DD)
      const d = document.createElement('div');
      d.className = 'date';
      const dateObj = new Date(item.publishedAt);
const mm = String(dateObj.getMonth() + 1).padStart(2, '0'); // months are 0-based
const dd = String(dateObj.getDate()).padStart(2, '0');
const yyyy = dateObj.getFullYear();
d.textContent = `${mm}/${dd}/${yyyy}`;

  
      // time ago
      const t = document.createElement('div');
      t.className = 'time';
      t.textContent = timeAgo(item.publishedAt);
  
      // website (far right)
      const s = document.createElement('div');
      s.className = 'source';
      s.textContent = hostFrom(item.link) || 'nytimes.com';
  
      r.appendChild(c); r.appendChild(d); r.appendChild(t); r.appendChild(s);
      return r;
    }
  
    // ===== data =====
    async function fetchFeed() {
      const res = await fetch('/api/feed', { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      return res.json();
    }
  
    async function refresh() {
      refreshBtn.disabled = true;
      errorEl.hidden = true;
      try {
        const data = await fetchFeed();
        const items = Array.isArray(data.items) ? data.items : [];
        board.innerHTML = '';
        renderHeader();
        items.forEach(it => board.appendChild(rowTemplate(it)));
        countBadge.textContent = String(items.length);
      } catch (err) {
        errorEl.textContent = 'Failed to load: ' + (err?.message || err);
        errorEl.hidden = false;
      } finally {
        refreshBtn.disabled = false;
      }
    }
  
    // ===== controls: auto toggle =====
    function startAuto() {
      if (autoTimer) clearInterval(autoTimer);
      autoTimer = setInterval(refresh, AUTO_MS);
      autoOn = true;
      autoBtn.classList.add('active');
      autoBtn.textContent = 'Auto Refresh: on';
    }
    function stopAuto() {
      if (autoTimer) clearInterval(autoTimer);
      autoTimer = null;
      autoOn = false;
      autoBtn.classList.remove('active');
      autoBtn.textContent = 'Auto Refresh: off';
    }
    autoBtn.addEventListener('click', () => (autoOn ? stopAuto() : startAuto()));
  
    // ===== controls: striped toggle =====
    stripeBtn.addEventListener('click', () => {
      striped = !striped;
      document.body.classList.toggle('striped', striped);
      if (striped) {
        stripeBtn.classList.add('active');
        stripeBtn.textContent = 'Striped: on';
      } else {
        stripeBtn.classList.remove('active');
        stripeBtn.textContent = 'Striped: off';
      }
    });
  
    // keyboard: r = refresh, a = toggle auto
    window.addEventListener('keydown', (e) => {
      if (e.key === 'r') refresh();
      if (e.key === 'a') (autoOn ? stopAuto() : startAuto());
    });
  
    // ===== boot =====
    refresh().then(startAuto);
  </script>
  
</body>
</html>
